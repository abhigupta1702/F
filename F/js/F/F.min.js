/*! F - v0.2.0 - 2013-05-07
* https://lazd.github.com/Class/
* Copyright (c) 2013 Larry Davis <lazdnet@gmail.com>; Licensed BSD */
var Class;(function(){var t=function(t){var e=t.bind(this);return e._methodName=t._methodName,this[e._methodName]=e,e},e=function(t){return new Class(_.extend({},t,{extend:this}))};Class=function(i){i=i||{},i.hasOwnProperty("extend")&&!i.extend&&console.warn("Class: %s is attempting to extend a non-truthy thing","function"===i.toString?i.toString:i.toString,i.extend);var n=i.extend||Object,o=i.construct,s=i.destruct;if(delete i.bind,delete i.extend,delete i.destruct,delete i.construct,i.hasOwnProperty("toString")&&"function"!=typeof i.toString){var r=i.toString;i.toString=function(){return""+r}}else!i.hasOwnProperty("toString")&&n.prototype.hasOwnProperty("toString")&&(i.toString=n.prototype.toString);var h=i,l=Object.create(n&&n.prototype);if(l.superClass=n.prototype,h)for(var d in h)h.hasOwnProperty(d)&&(l[d]=h[d],"function"==typeof h[d]&&(l[d]._methodName=d,l[d]._parentProto=l));l.inherited=function(t){var e=t.callee,i=e._methodName;if(!i)return console.error("Class.inherited: can't call inherited method: calling method did not have _methodName",t.callee),void 0;for(var n=e._parentProto,o=null;n.superClass&&(n=n.superClass,o=n[i],"function"!=typeof o););if("function"==typeof o){var s=this.inherited;this.inherited=n.inherited;var r=o.apply(this,t);return this.inherited=s,r}console.warn("Class.inherited: can't call inherited method for '%s': no method by that name found",i)},l.bind=t,l.destruct=function(){"function"==typeof s&&s.apply(this,arguments),n&&n.prototype&&"function"==typeof n.prototype.destruct&&n.prototype.destruct.apply(this,arguments)},l.construct=function(){var t=arguments;void 0===t[0]&&(t.length=1,t[0]={}),n&&n.prototype&&"function"==typeof n.prototype.construct&&n.prototype.construct.apply(this,arguments),"function"==typeof o&&o.apply(this,arguments)};var a=function(){var t=Object.create(l);return l.construct.apply(t,arguments),"function"==typeof l.constructed&&l.constructed.apply(t,arguments),t};return a.prototype=l,a.extend=e,l.constructor=a,a},Object.create||(Object.create=function(t){function e(){}if(arguments.length>1)throw Error("Object.create implementation only accepts the first parameter.");return e.prototype=t,new e}),Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),i=this,n=function(){},o=function(){return i.apply(this instanceof n?this:t,e.concat(Array.prototype.slice.call(arguments)))};return n.prototype=this.prototype,o.prototype=new n,o})})();var F=F||{};try{window["ƒ"]=F}catch(err){console.log("ƒ: could not set ƒ variable")}F.options={debug:!1,precompiledTemplates:!0},_.extend(F,Backbone.Events),F.extendView=function(t,e){var i=t.prototype.View||t.prototype.ListView;return i?(e.events=_.extend({},i.prototype.events,e.events),i.extend(e)):void 0},F.addToSet=function(t,e,i){t[e]!==void 0?(_.isArray(t[e])||(t[e]=[t[e]]),t[e].push(i)):t[e]=i},F.set=function(t,e,i,n){t||(t={});var o=e.split(".");if(o.length>1){var s=t;o.forEach(function(t,e){e===o.length-1?n?F.addToSet(s,t,i):s[t]=i:(s[t]===void 0&&(s[t]={}),s=s[t])})}else n?F.addToSet(t,e,i):t[e]=i;return t},F.EventEmitter=new Class(Backbone.Events),function(){var t=/^(\S+)\s*(.*)$/,e=function(t,e){return t&&t[e]?_.isFunction(t[e])?t[e]():t[e]:null};F.View=Backbone.View.extend({initialize:function(){if(void 0!==this.options.container&&void 0!==this.options.el)throw Error("View: should provide either options.el or options.container, never both");var t=this.options.template||this.template;if(t&&(this.template=F.options.precompiledTemplates?t:Handlebars.template(t)),this.render=this.render.bind(this),this.options.el){var e=this.$el[0].nodeName.toUpperCase(),i=this.tagName.toUpperCase();if("div"!==this.tagName&&e!==i)throw Error("View: cannot create view, incorrect tag provided. Expected "+i+", but got "+e);this.$el.addClass(this.className)}this.container=this.options.container,this.component=this.options.component,this.options.events&&this.delegateEvents(this.options.events),this.options.model&&this.setModel(this.options.model),this.rendered=null},setModel:function(t){this.model&&this.model.off&&this.stopListening(this.model),this.model=t;var e=this.options.noRerender||this.options.component&&this.options.component.options.noRerender;this.model&&this.model.on&&!e&&this.listenTo(this.model,"change",this.render),this.rendered=null},age:function(){return null!==this.rendered?(new Date).getTime()-this.rendered:-1},remove:function(){this.$el.remove(),this.model&&this.model.off&&this.stopListening()},show:function(){return this.template&&this.renderOnce(),this.$el.show(),this},hide:function(){return this.$el.hide(),this},renderOnce:function(){return null===this.rendered&&this.render(),this},inDebugMode:function(){return F.options.debug||this.component&&this.component.options.debug},render:function(){if(this.inDebugMode()&&console.log("%s: Rendering view...",this.component&&""+this.component||"Orphaned view"),this.template){var t=this.model||this.component&&this.component.model;this.$el.html(this.template(t&&t.toJSON&&t.toJSON()||t||{}))}return this.container&&!$(this.el.parentNode).is(this.container)&&$(this.container).append(this.el),this.rendered=(new Date).getTime(),this.trigger("renderComplete"),this},delegateEvents:function(i){if(i||(i=e(this,"events"))){this.undelegateEvents();for(var n in i){var o=i[n],s=this.component;if(!_.isFunction(o))if(this.component){var r=i[n].split(".");if(r.length>1){o=this.component;for(var h=0;r.length>h;h++){var l=r[h];if(s=o,o=o[l],!o)break}}else o=this.component[i[n]]}else o=this[i[n]];if(!o)throw Error('Method "'+i[n]+'" does not exist');var d=n.match(t),a=d[1],c=d[2];o=this.component?_.bind(o,s):_.bind(o,this),a+=".delegateEvents"+this.cid,""===c?this.$el.bind(a,o):this.$el.delegate(c,a,o)}return this}}})}(),function(){function t(t){return t.slice(0,1).toLowerCase()+t.slice(1)}F.Component=new Class({toString:"Component",extend:F.EventEmitter,options:{singly:!1,visible:!1,debug:!1},construct:function(t){this.mergeOptions(),this.applyOptions(t),this.components={},this._bubbledEvts={},this.bind(this._handleSubComponentShown),this.bind(this.render)},constructed:function(){if(this.view){this.view.el?this.options.visible===!0?this.show({silent:!0}):this.view.$el.hide():console.warn("Component %s has a view without an element",this.toString,this,this.view,this.view.options);var t=this;this.listenTo(this.view,"renderComplete",function(){"function"==typeof this.handleRenderComplete&&this.handleRenderComplete(),t.trigger("view:rendered",{component:t,view:t.view})})}},destruct:function(){this.view&&this.view.remove(),this.removeComponents(),this.stopListening(),delete this.components},render:function(){return this.view&&this.view.render(),this},bubble:function(t,e){if(!this[t])return console.error("%s: cannot set event '%s' for bubbling from component '%s', component does not exist",""+this,e,t),this;this._bubbledEvts[t]||(this._bubbledEvts[t]={});var i=this._bubbledEvts[t][e]=function(){var t=Array.prototype.slice.call(arguments);t.unshift(e),this.trigger.apply(this,t)}.bind(this);return this[t].on(e,i),this},unbubble:function(t,e){return this._bubbledEvts[t]&&this._bubbledEvts[t][e]?(this[t].off(e,this._bubbledEvts[t][e]),this):(console.warn("%s: cannot discontinue bubbling of event '%s' for component '%s', event was not set for bubbling",""+this,e,t),this)},addComponent:function(e,i){return i=i?t(i):t(""+e),e.setName(i),this[i]=this.components[i]=e,e.parent=this,this.listenTo(e,"component:shown",this._handleSubComponentShown),e},removeComponent:function(t){var e=this[t];return void 0!==e&&(this.stopListening(e),delete this[t],delete this.components[t],"function"==typeof e.destruct&&e.destruct()),this},removeComponents:function(){for(var t in this.components)this.components[t].destruct(),delete this[t];return this},_handleSubComponentShown:function(t){var e=this.components[t.name];void 0!==e&&this.options.singly&&!e.options.overlay&&(this.hideAllSubComponents([t.name]),this.currentSubComponent=e)},show:function(t){return t=t||{},this.inDebugMode()&&(this.isVisible()?console.log("%s: not showing self; already visible",""+this):console.log("%s: showing self",""+this)),t.silent||this.options.independent||this.trigger("component:shown",{name:""+this,component:this}),this.view&&this.view.show(),this.options.isSetup||"function"!=typeof this.setup||(this.setup(t),this.options.isSetup=!0),this.options.visible=!0,this},hide:function(t){return t=t||{},this.isVisible()?(this.inDebugMode()&&console.log("%s: hiding self",""+this),this.view&&this.view.hide(),t.silent||this.trigger("component:hidden",{name:""+this,component:this}),this.options.isSetup&&"function"==typeof this.teardown&&(this.teardown(t),this.options.isSetup=!1),this.options.hideChildren!==!1&&this.hideAllSubComponents(),this.options.visible=!1,this):!1},inDebugMode:function(){return this.options.debug||F.options.debug},isVisible:function(){return this.options.visible},showAllSubComponents:function(t){t=_.isArray(t)?t:[];for(var e in this.components)~t.indexOf(e)||this.components[e].show();return this},hideAllSubComponents:function(t){t=_.isArray(t)?t:!1;for(var e in this.components)t&&~t.indexOf(e)||this.components[e].hide();return this},setName:function(t){return this.toString=function(){return t},this},setPropsFromOptions:function(t,e){return _.each(e,function(e){this[e]=t[e]||this[e],delete t[e]}.bind(this)),this},mergeOptions:function(){for(var t=[],e=this.constructor.prototype;e;)e.hasOwnProperty("options")&&t.unshift(e.options),e=e.superClass;t.unshift({}),this.options=_.extend.apply(_,t)},applyOptions:function(t){for(var e in t)this.options.hasOwnProperty(e)&&(this.options[e]=t[e]);return _.extend(t,this.options),t}})}(),F.ModelComponent=new Class({toString:"ModelComponent",extend:F.Component,construct:function(t){this.Model=this.Model||t.Model},Model:Backbone.Model,refresh:function(t){return this.trigger("model:loading",{model:this.model}),this.model.fetch({success:function(e,i){var n=!0;"function"==typeof this.handleLoadSuccess&&(n=this.handleLoadSuccess(this.model,i)===!1?!1:!0),n&&(this.model.trigger("loaded"),this.trigger("model:loaded",{model:this.model}),"function"==typeof t&&t.call(this,this.model))}.bind(this),error:function(t,e){console.warn("%s: Error loading model",""+this),this.trigger("model:loadFailed",{model:this.model,response:e}),"function"==typeof this.handleLoadError&&this.handleLoadError(this.model,e)}.bind(this)}),this},_setModel:function(t){return this.model=t,this.model&&this.model.off&&this.view&&this.view.setModel(t),this},fetch:function(t,e){var i={};void 0!==t&&(i[this.Model.prototype.idAttribute]=t),this.trigger("model:loading",{model:this.model});var n=new this.Model(i);return n.fetch({success:function(t,i){this._setModel(t);var n=!0;"function"==typeof this.handleLoadSuccess&&(n=this.handleLoadSuccess(this.model,i)===!1?!1:!0),n&&(this.trigger("model:loaded",{model:this.model}),"function"==typeof e&&e.call(this,this.model))}.bind(this),error:function(t,e){console.warn("%s: Error loading model",""+this),this.trigger("model:loadFailed",{model:this.model,response:e}),"function"==typeof this.handleLoadError&&this.handleLoadError(this.model,e)}.bind(this)}),this},load:function(t){return t instanceof Backbone.Model?this._setModel(t):this._setModel(new this.Model(t)),this.trigger("model:loaded",{model:this.model}),this},save:function(t,e,i){return this.model?(this.inDebugMode()&&console.log("%s: Saving...",""+this),this.trigger("model:saving",{model:this.model}),this.model.save(t||{},_.extend({success:function(t,i){this.inDebugMode()&&console.log("%s: Save successful",""+this),"function"==typeof e&&e.call(this,null,this.model,i),"function"==typeof this.handleSaveSuccess&&this.handleSaveSuccess(this.model,i),this.trigger("model:saved",{model:this.model,response:i})}.bind(this),error:function(t,i){console.warn("%s: Error saving model",""+this),"function"==typeof e&&e.call(this,Error("Error saving model"),this.model,i),"function"==typeof this.handleSaveError&&this.handleSaveError(this.model,i),this.trigger("model:saveFailed",{model:this.model,response:i})}.bind(this)},i))):console.warn("%s: Cannot save, model is not truthy",""+this),this},show:function(t){return t=t||{},t.id?(this.inDebugMode()&&console.log("%s: fetching item with ID %s",""+this,t.id),this.fetch(t.id,function(){this.inDebugMode()&&console.log("%s: fetch complete!",""+this),this.show({silent:t.silent})})):t.model?(this.inDebugMode()&&console.log("%s: showing with new model",""+this,t.model),this.load(t.model),this.show({silent:t.silent})):this.inherited(arguments),this}}),F.CollectionComponent=new Class({toString:"CollectionComponent",extend:F.Component,options:{defaultParams:{}},construct:function(t){this.bind(this.addModel),this.bind(this.removeModel),this.bind(this.render),this._useCollection(new this.Collection),this.options.defaultParams=_.extend({},this.options.defaultParams,t.defaultParams),this.params=_.extend({},this.options.defaultParams),this.collectionLoaded=!1},destruct:function(){this._releaseCollection()},Collection:Backbone.Collection,_useCollection:function(t){this.collection=t,this.listenTo(this.collection,"add",this.addModel),this.listenTo(this.collection,"remove",this.removeModel),this.listenTo(this.collection,"loaded",this.render)},_releaseCollection:function(){this.stopListening(this.collection),this.collection=null},refresh:function(t){return this.fetch(this.params,t),this},addModel:function(){},removeModel:function(){},clearParams:function(){return this.params={},this},fetch:function(t,e){return this.params=t?_.extend({},this.options.defaultParams,t):_.extend({},this.options.defaultParams),this.trigger("collection:loading",this.collection),this.collection.fetch({data:this.params,success:function(){this.collection.trigger("loaded"),this.trigger("collection:loaded",this.collection),this.collectionLoaded=!0,"function"==typeof e&&e.call(this,this.collection)}.bind(this)}),this},load:function(t){return this._releaseCollection(),t instanceof Backbone.Collection?this._useCollection(t):this._useCollection(new this.Collection(t)),this},show:function(t){return t=t||{},t.params?this.fetch(t.params,function(){this.show({silent:t.silent})}):this.collectionLoaded?this.inherited(arguments):this.refresh(function(){this.show({silent:t.silent})}),this}}),function(){var t=F.View.extend({tagName:"form",events:{submit:"handleSubmit"}});F.FormComponent=new Class({toString:"FormComponent",extend:F.ModelComponent,construct:function(t){this.view=new this.View(_.extend({component:this,template:this.Template},t)),this.model=new this.Model,this.bind(this.handleSubmit)},View:t,Template:null,clear:function(){return this._setModel(new this.Model),"function"==typeof this.handleLoadSuccess&&this.handleLoadSuccess(this.model),this.render(),this},doBlur:function(){var t=this.view.$('[type="submit"], button').filter(":visible").last().focus();setTimeout(function(){t.blur()},10)},handleSubmit:function(t){this.doBlur(),t&&t.preventDefault&&t.preventDefault(),this.saveForm()},extractValuesFromForm:function(){var t=this.view.$el;"FORM"!==this.view.el.tagName&&(t=this.view.$("form"));var e=t.filter(':not([data-serialize="false"])').serializeArray(),i={};return _.each(e,function(t){F.set(i,t.name,t.value,!0)}),i},setValuesFromForm:function(){this.model.set(this.extractValuesFromForm())},saveForm:function(t){this.save(this.extractValuesFromForm(),t)}})}(),function(){var t=F.View.extend({tagName:"ul",initialize:function(t){t=t||{},F.View.prototype.initialize.apply(this,arguments),this.collection=t.collection,this.ItemView=t.ItemView||this.ItemView,this.ItemTemplate=t.ItemTemplate||this.ItemTemplate,this.subViews=[],this.addSubView=this.addSubView.bind(this)},addSubView:function(t){var e=new this.ItemView({model:t,template:this.ItemTemplate,component:this.component});e.render(),this.options.ListContainer?this.$(this.options.ListContainer).append(e.el):this.$el.append(e.el),e.$el.data("viewIndex",this.subViews.length),this.subViews.push(e)},remove:function(){this.removeSubViews(),F.View.prototype.remove.call(this,arguments)},removeSubView:function(t){var e=null,i=-1;"Number"!=typeof i?_.some(this.subViews,function(n,o){n&&n.model===t&&(e=n,i=o)}.bind(this)):e=this.subViews[i],e&&(e.remove(),this.subViews[i]=void 0)},removeSubViews:function(){this.subViews.length&&(_.each(this.subViews,function(t){t&&t.remove()}),this.subViews=[])},render:function(){if(this.inDebugMode()&&console.log("%s: rendering list view...",this.component&&""+this.component||"List view"),this.container&&!$(this.el.parentNode).is(this.container)&&$(this.container).append(this.el),null===this.rendered&&(this.template&&this.$el.html(this.template({})),this.rendered=(new Date).getTime()),this.removeSubViews(),this.collection.each(this.addSubView),this.collection.isEmpty()){var t,e=this.ItemView;if(_.isEqual(this.component.params,this.component.options.defaultParams)&&this.component.ListEmptyTemplate?(t=this.component.ListEmptyTemplate,this.component.ListEmptyView&&(e=this.component.ListEmptyView)):this.component.NoResultsTemplate&&(t=this.component.NoResultsTemplate,this.component.NoResultsView&&(e=this.component.NoResultsView)),t){var i=new e({template:t,component:this.component,model:this.component.params}).render();this.options.ListContainer?this.$(this.options.ListContainer).append(i.el):this.$el.append(i.el),this.subViews.push(i)}}return this.rendered=(new Date).getTime(),this.trigger("renderComplete"),this}}),e=F.View.extend({tagName:"li",className:"listItem"});F.ListComponent=new Class({toString:"ListComponent",extend:F.CollectionComponent,construct:function(t){this.view=new this.ListView(_.extend({component:this,collection:this.collection,template:this.ListTemplate,ItemView:this.ItemView,ItemTemplate:this.ItemTemplate,ListContainer:this.ListContainer,events:_.extend({},{"click li":"handleSelect"},this.ListView.prototype.events)},t)),this.selectedItem=null},Collection:Backbone.Collection,NoResultsTemplate:null,NoResultsView:null,ListEmptyView:null,ListEmptyTemplate:null,ListTemplate:null,ListView:t,ItemTemplate:null,ItemView:e,addModel:function(t){this.view.addSubView(t)},removeModel:function(t){this.view.removeSubView(t)},getModelFromLi:function(t){var e=$(t).data("viewIndex");return void 0!==e&&this.view.subViews[e]&&this.view.subViews[e].model||null},getViewFromLi:function(t){return this.view.subViews[$(t).data("viewIndex")]},handleSelect:function(t){var e=this.getModelFromLi(t.currentTarget);e&&(this.selectedItem=e.id,this.trigger("list:itemSelected",{listItem:$(t.currentTarget),model:e}))}})}();