/*! F - v0.1.0 - 2013-01-23
* http://lazd.github.com/F/
* Copyright (c) 2013 Lawrence Davis; Licensed BSD */
var Class;(function(){var e=function(e){var t=e.bind(this);return t._methodName=e._methodName,this[t._methodName]=t,t},t=function(e){return new Class(_.extend({},e,{extend:this}))};Class=function(n){n=n||{},n.hasOwnProperty("extend")&&!n.extend&&console.warn("Class: %s is attempting to extend a non-truthy thing",n.toString==="function"?n.toString:n.toString,n.extend);var r=n.extend||Object,i=n.construct,s=n.destruct;delete n.bind,delete n.extend,delete n.destruct,delete n.construct;if(n.hasOwnProperty("toString")&&typeof n.toString!="function"){var o=n.toString;n.toString=function(){return o.toString()}}else!n.hasOwnProperty("toString")&&r.prototype.hasOwnProperty("toString")&&(n.toString=r.prototype.toString);var u=n,a=Object.create(r&&r.prototype);a.superClass=r.prototype;if(u)for(var f in u)u.hasOwnProperty(f)&&(a[f]=u[f],typeof u[f]=="function"&&(a[f]._methodName=f,a[f]._parentProto=a));a.inherited=function(e){var t=e.callee,n=t._methodName;if(!n){console.error("Class.inherited: can't call inherited method: calling method did not have _methodName",e.callee);return}var r=t._parentProto,i=null;while(r.superClass){r=r.superClass,i=r[n];if(typeof i=="function")break}if(typeof i=="function"){var s=this.inherited;this.inherited=r.inherited;var o=i.apply(this,e);return this.inherited=s,o}console.warn("Class.inherited: can't call inherited method for '%s': no method by that name found",n)},a.bind=e,a.destruct=function(){typeof s=="function"&&s.apply(this),r&&r.prototype&&typeof r.prototype.destruct=="function"&&r.prototype.destruct.apply(this)},a.construct=function(){var e=arguments;e[0]===undefined&&(e.length=1,e[0]={}),r&&r.prototype&&typeof r.prototype.construct=="function"&&r.prototype.construct.apply(this,arguments),typeof i=="function"&&i.apply(this,arguments)};var l=function(){var e=Object.create(a);return a.construct.apply(e,arguments),e};return l.prototype=a,l.extend=t,a.constructor=l,l},Object.create||(Object.create=function(e){function t(){}if(arguments.length>1)throw new Error("Object.create implementation only accepts the first parameter.");return t.prototype=e,new t}),Function.prototype.bind||(Function.prototype.bind=function(e){if(typeof this!="function")throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,r=function(){},i=function(){return n.apply(this instanceof r?this:e,t.concat(Array.prototype.slice.call(arguments)))};return r.prototype=this.prototype,i.prototype=new r,i})})();var F=F||{};try{window["ƒ"]=F}catch(err){console.log("ƒ: could not set ƒ variable")}F.options={debug:!1,precompiledTemplates:!0},_.extend(F,Backbone.Events),F.EventEmitter=new Class(Backbone.Events),function(){var e=/^(\S+)\s*(.*)$/,t=function(e,t){return!e||!e[t]?null:_.isFunction(e[t])?e[t]():e[t]};F.View=Backbone.View.extend({initialize:function(){if(this.options.container!==undefined&&this.options.el!==undefined)throw new Error("View: should provide either options.el or options.container, never both");var e=this.options.template||this.template;e&&(F.options.precompiledTemplates?this.template=e:this.template=Handlebars.template(e)),this.render=this.render.bind(this);if(this.options.el){var t=this.$el[0].nodeName.toUpperCase(),n=this.tagName.toUpperCase();if(this.tagName!=="div"&&t!==n)throw new Error("View: cannot create view, incorrect tag provided. Expected "+n+", but got "+t);this.$el.addClass(this.className)}this.container=this.options.container,this.component=this.options.component,this.options.events&&this.delegateEvents(this.options.events),this.options.model&&this.setModel(this.options.model),this.rendered=null},setModel:function(e){this.model&&this.model.off&&this.stopListening(this.model),this.model=e,this.model&&this.model.on&&!this.options.noRerender&&this.listenTo(this.model,"change",this.render),this.rendered=null},age:function(){return this.rendered!==null?(new Date).getTime()-this.rendered:-1},remove:function(){this.$el.remove(),this.model.off&&this.stopListening()},show:function(){return this.template&&this.renderOnce(),this.$el.show(),this},hide:function(){return this.$el.hide(),this},renderOnce:function(){return this.rendered===null&&this.render(),this},inDebugMode:function(){return F.options.debug||this.component&&this.component.options.debug},render:function(){this.inDebugMode()&&console.log("%s: Rendering view...",this.component&&this.component.toString()||"Orphaned view");if(this.template){var e=this.model||this.component&&this.component.model;this.$el.html(this.template(e&&e.toJSON&&e.toJSON()||e||{}))}return this.container&&!$(this.el.parentNode).is(this.container)&&$(this.container).append(this.el),this.rendered=(new Date).getTime(),this.trigger("renderComplete"),this},delegateEvents:function(n){if(!n&&!(n=t(this,"events")))return;this.undelegateEvents();for(var r in n){var i=n[r],s=this.component;if(!_.isFunction(i))if(this.component){var o=n[r].split(".");if(o.length>1){i=this.component;for(var u=0;u<o.length;u++){var a=o[u];s=i,i=i[a];if(!i)break}}else i=this.component[n[r]]}else i=this[n[r]];if(!i)throw new Error('Method "'+n[r]+'" does not exist');var f=r.match(e),l=f[1],c=f[2];i=this.component?_.bind(i,s):_.bind(i,this),l+=".delegateEvents"+this.cid,c===""?this.$el.bind(l,i):this.$el.delegate(c,l,i)}return this}})}(),function(){function e(e){return e.slice(0,1).toLowerCase()+e.slice(1)}F.Component=new Class({toString:"Component",extend:F.EventEmitter,options:{singly:!1,visible:!1,debug:!1},construct:function(e){this.mergeOptions(),this.applyOptions(e),this.components={},this._bubbledEvts={},this.bind(this._handleSubComponentShown),this.bind(this.render)},destruct:function(){this.view&&this.view.remove();for(var e in this.components)this.components[e].destruct(),delete this[e];this.stopListening(),delete this.components},render:function(){return this.view&&this.view.render(),this},bubble:function(e,t){if(!this[e])return console.error("%s: cannot set event '%s' for bubbling from component '%s', component does not exist",this.toString(),t,e),this;this._bubbledEvts[e]||(this._bubbledEvts[e]={});var n=this._bubbledEvts[e][t]=function(){var e=Array.prototype.slice.call(arguments);e.unshift(t),this.trigger.apply(this,e)}.bind(this);return this[e].on(t,n),this},unbubble:function(e,t){return!this._bubbledEvts[e]||!this._bubbledEvts[e][t]?(console.warn("%s: cannot discontinue bubbling of event '%s' for component '%s', event was not set for bubbling",this.toString(),t,e),this):(this[e].off(t,this._bubbledEvts[e][t]),this)},addComponent:function(t,n){return n?n=e(n):n=e(t.toString()),t.setName(n),this[n]=this.components[n]=t,t.view&&(t.view.el?t.options.visible===!0?t.show({silent:!0}):t.view.$el.hide():console.warn("Component %s has a view without an element",n,t,t.view,t.view.options)),t.parent=this,this.listenTo(t,"component:shown",this._handleSubComponentShown),t},removeComponent:function(e){var t=this[e];return t!==undefined&&(this.stopListening(t),delete this[e],delete this.components[e]),this},_handleSubComponentShown:function(e){var t=this.components[e.name];t!==undefined&&(this.options.singly&&!t.overlay&&(this.hideAllSubComponents([e.name]),this.currentSubComponent=t),this.trigger("subComponent:shown",{name:e.name,component:e.component}),this.show())},show:function(e){return e=e||{},this.inDebugMode()&&(this.isVisible()?console.log("%s: not showing self; already visible",this.toString()):console.log("%s: showing self",this.toString())),e.silent||this.trigger("component:shown",{name:this.toString(),component:this}),this.view&&this.view.show(),this.options.visible=!0,this},hide:function(e){return e=e||{},this.isVisible()?(this.inDebugMode()&&console.log("%s: hiding self",this.toString()),this.view&&this.view.hide(),e.silent||this.trigger("component:hidden",{name:this.toString(),component:this}),this.options.visible=!1,this):!1},inDebugMode:function(){return this.options.debug||F.options.debug},isVisible:function(){return this.options.visible},showAllSubComponents:function(e){e=_.isArray(e)?e:[];for(var t in this.components){if(~e.indexOf(t))continue;this.components[t].show()}return this},hideAllSubComponents:function(e){e=_.isArray(e)?e:[];for(var t in this.components){if(~e.indexOf(t))continue;this.components[t].hide()}return this},setName:function(e){return this.toString=function(){return e},this},setPropsFromOptions:function(e,t){return _.each(t,function(t){this[t]=e[t]||this[t],delete e[t]}.bind(this)),this},mergeOptions:function(){var e=[],t=this.constructor.prototype;while(t)t.hasOwnProperty("options")&&e.unshift(t.options),t=t.superClass;e.unshift({}),this.options=_.extend.apply(_,e)},applyOptions:function(e){for(var t in e)this.options.hasOwnProperty(t)&&(this.options[t]=e[t]);return _.extend(e,this.options),e}})}(),F.ModelComponent=new Class({toString:"ModelComponent",extend:F.Component,construct:function(e){this.Model=this.Model||e.Model},Model:Backbone.Model,refresh:function(e){return this.model.fetch({success:function(){this.model.trigger("loaded"),this.trigger("model:loaded",this.model),typeof e=="function"&&e.call(this,this.model)}.bind(this),error:function(e,t){console.warn("%s: Error loading model",this.toString()),this.trigger("model:loadFailed",{response:t})}.bind(this)}),this},_setModel:function(e){return this.model=e,this.model&&this.model.off&&this.view&&this.view.setModel(e),this},fetch:function(e,t){var n={};e!==undefined&&(n[this.Model.prototype.idAttribute]=e);var r=new this.Model(n);return r.fetch({success:function(){this._setModel(r),this.trigger("model:loaded",this.model),typeof t=="function"&&t.call(this,r)}.bind(this),error:function(e,t){console.warn("%s: Error loading model",this.toString()),this.trigger("model:loadFailed",{response:t})}.bind(this)}),this},load:function(e){return e instanceof Backbone.Model?this._setModel(e):this._setModel(new this.Model(e)),this.trigger("model:loaded",this.model),this},save:function(e,t,n){return this.model?(this.inDebugMode()&&console.log("%s: Saving...",this.toString()),this.model.save(e||{},_.extend({success:function(e,n){this.inDebugMode()&&console.log("%s: Save successful",this.toString()),typeof t=="function"&&t.call(this,null,this.model,n),this.trigger("model:saved",{model:this.model,response:n})}.bind(this),error:function(e,n){console.warn("%s: Error saving model",this.toString()),typeof t=="function"&&t.call(this,new Error("Error saving model"),this.model,n),this.trigger("model:saveFailed",{model:this.model,response:n})}.bind(this)},n))):console.warn("%s: Cannot save, model is not truthy",this.toString()),this},show:function(e){return e=e||{},e.id?(this.inDebugMode()&&console.log("%s: fetching item with ID %s",this.toString(),e.id),this.fetch(e.id,function(t){this.inDebugMode()&&console.log("%s: fetch complete!",this.toString()),this.show({silent:e.silent})})):e.model?(this.inDebugMode()&&console.log("%s: showing with new model",this.toString(),e.model),this.load(e.model),this.show({silent:e.silent})):this.inherited(arguments),this}}),F.CollectionComponent=new Class({toString:"CollectionComponent",extend:F.Component,options:{defaultParams:{}},construct:function(e){this.bind(this.addModel),this.bind(this.removeModel),this.bind(this.render),this._useCollection(new this.Collection),this.options.defaultParams=_.extend({},this.options.defaultParams,e.defaultParams),this.params=_.extend({},this.options.defaultParams),this.collectionLoaded=!1},destruct:function(){this._releaseCollection()},Collection:Backbone.Collection,_useCollection:function(e){this.collection=e,this.listenTo(this.collection,"add",this.addModel),this.listenTo(this.collection,"remove",this.removeModel),this.listenTo(this.collection,"loaded",this.render)},_releaseCollection:function(){this.stopListening(this.collection),this.collection=null},refresh:function(e){return this.fetch(this.params,e),this},addModel:function(e){},removeModel:function(e){},clearParams:function(){return this.params={},this},fetch:function(e,t){return e?this.params=_.extend({},this.options.defaultParams,e):this.params=_.extend({},this.options.defaultParams),this.collection.fetch({data:this.params,success:function(){this.collection.trigger("loaded"),this.trigger("collection:loaded",this.collection),this.collectionLoaded=!0,typeof t=="function"&&t.call(this,this.collection)}.bind(this)}),this},load:function(e){return this._releaseCollection(),e instanceof Backbone.Collection?this._useCollection(e):this._useCollection(new this.Collection(e)),this},show:function(e){return e=e||{},e.params?this.fetch(e.params,function(){this.show({silent:e.silent})}):this.collectionLoaded?this.inherited(arguments):this.refresh(function(){this.show({silent:e.silent})}),this}}),function(){var e=F.View.extend({tagName:"form",events:{}});F.FormComponent=new Class({toString:"FormComponent",extend:F.ModelComponent,construct:function(e){this.view=new this.View(_.extend({component:this,template:this.Template},e)),this.model=new this.Model,this.bind(this.handleSubmit),this.view.$el.on("submit",this.handleSubmit)},destruct:function(){this.view.$el.off("submit",this.handleSubmit)},View:e,Template:null,clear:function(){return this._setModel(new this.Model),this.render(),this},handleSubmit:function(e){this.view.$el.find('[type="submit"], button').first().focus(),e&&e.preventDefault&&e.preventDefault();var t=this.view.$el.serializeArray(),n={};_.each(t,function(e){n[e.name]=e.value}),this.save(n)}})}(),function(){var e=F.View.extend({tagName:"ul",initialize:function(e){e=e||{},F.View.prototype.initialize.apply(this,arguments),this.collection=e.collection,this.ItemView=e.ItemView||this.ItemView,this.ItemTemplate=e.ItemTemplate||this.ItemTemplate,this.subViews=[],this.addSubView=this.addSubView.bind(this)},addSubView:function(e){var t=new this.ItemView({model:e,template:this.ItemTemplate,component:this.component});t.render(),this.$el.append(t.el),t.$el.data("viewIndex",this.subViews.length),this.subViews.push(t)},remove:function(){this.removeSubViews(),F.View.prototype.remove.call(this,arguments)},removeSubView:function(e){var t=null,n=-1;typeof n!="Number"?_.some(this.subViews,function(r,i){r&&r.model===e&&(t=r,n=i)}.bind(this)):t=this.subViews[n],t&&(t.remove(),this.subViews[n]=undefined)},removeSubViews:function(){this.subViews.length&&(_.each(this.subViews,function(e){e&&e.remove()}),this.subViews=[])},render:function(){return this.inDebugMode()&&console.log("%s: rendering list view...",this.component&&this.component.toString()||"List view"),this.container&&!$(this.el.parentNode).is(this.container)&&$(this.container).append(this.el),this.removeSubViews(),this.collection.each(this.addSubView),this.rendered=(new Date).getTime(),this.trigger("renderComplete"),this}}),t=F.View.extend({tagName:"li",className:"listItem"});F.ListComponent=new Class({toString:"ListComponent",extend:F.CollectionComponent,construct:function(e){this.view=new this.ListView(_.extend({component:this,collection:this.collection,ItemView:this.ItemView,ItemTemplate:this.ItemTemplate,events:{"click li":"handleSelect"}},e)),this.selectedItem=null},Collection:Backbone.Collection,ListTemplate:null,ListView:e,ItemTemplate:null,ItemView:t,addModel:function(e){this.view.addSubView(e)},removeModel:function(e){this.view.removeSubView(e)},getModelFromLi:function(e){return this.view.subViews[$(e).data("viewIndex")].model},getViewFromLi:function(e){return this.view.subViews[$(e).data("viewIndex")]},handleSelect:function(e){var t=this.getModelFromLi(e.currentTarget);this.selectedItem=t.id,this.trigger("list:itemSelected",{listItem:$(e.currentTarget),model:t})}})}();