/*! F - v1.0.1 - 2015-03-30
* https://lazd.github.com/F/
* Copyright (c) 2015 Larry Davis <lazdnet@gmail.com>; Licensed BSD */

!function(a){function b(){var a,b,c,d,e;for(c=arguments,a=0,b=c.length;b>a;a++){d=c[a];for(e in d)this[e]=d[e]}return this}function c(a){return function(){return this[a].apply(this,arguments)}}function d(a,d){var e,f,g,h,i,j;a.properties=d,i={},e=a;do{if(e.properties)for(g in e.properties)j=i[g]||(i[g]=[]),j.unshift(e.properties[g]);e=e.superConstructor}while(e);h={};for(g in i)f=h[g]=b.apply({},i[g]),"string"==typeof f.set&&(f.set=c(f.set)),"string"==typeof f.get&&(f.get=c(f.get));a.properties=h}var e=function(){},f=/xyz/.test(function(){return"xyz"})?/\._super\b/:{test:function(){return!0}},g=function(a,b,c){return function(){var d=this._super;this._super=c[a];var e=b.apply(this,arguments);return this._super=d,e}},h=function(a,b,c){var d=c[a];return function(){return this._super=d,b.apply(this,arguments)}},i=function(a,b){b=b||this.constructor&&this.constructor.prototype;for(var c in a){var d=a[c];if("construct"!==c&&"destruct"!==c){var e=b&&"function"==typeof d&&"function"==typeof b[c]&&f.test(d);this[c]=e?this.hasOwnProperty(c)?h(c,d,this):g(c,d,b):d}}},j=function(a){return a&&a.extend?a.extend.extend(a):j.extend(a)};j.prototype.mixin=i,j.extend=function k(a){function b(){if(this instanceof b==!1)throw new Error("Cannot create instance without new operator");var a=b.properties;a&&Object.defineProperties(this,a),this.construct.apply(this,arguments),this.init()}var c=this,f=this.prototype;b.superConstructor=c,b.extend=k;var g=b.prototype=Object.create(f);if(g.constructor=b,g.superPrototype=f,a){var h=a.properties;if(delete a.properties,i.call(g,a,f),Array.isArray(a.mixins))for(var j=0,l=a.mixins.length;l>j;j++)i.call(g,a.mixins[j],g);if(d(b,h),a.construct){var m=a.construct;g.construct=f.construct?function(){f.construct.apply(this,arguments),m.apply(this,arguments)}:m}if(a.destruct){var n=a.destruct;g.destruct=f.destruct?function(){n.apply(this,arguments),f.destruct.apply(this,arguments)}:n}if("string"==typeof a.toString){var o=a.toString;g.toString=function(){return o}}}return"function"!=typeof g.construct&&(g.construct=e),"function"!=typeof g.init&&(g.init=e),b},"undefined"!=typeof module&&module.exports?module.exports=j:"function"==typeof a.define?!function(a){a(function(){return j})}(a.define):a.Class=a.PseudoClass=j}(this);var F=F||{};try{window["ƒ"]=F}catch(err){console.log("ƒ: could not set ƒ variable")}F.options={debug:!1},_.extend(F,Backbone.Events),F.extendView=function(a,b){var c=a.prototype.View||a.prototype.ListView;return c?(b.events=_.extend({},c.prototype.events,b.events),c.extend(b)):void 0},F.addToSet=function(a,b,c){"undefined"!=typeof a[b]?(_.isArray(a[b])||(a[b]=[a[b]]),a[b].push(c)):a[b]=c},F.set=function(a,b,c,d){a||(a={});var e=b.split(".");if(e.length>1){var f=a;e.forEach(function(a,b){b===e.length-1?d?F.addToSet(f,a,c):f[a]=c:("undefined"==typeof f[a]&&(f[a]={}),f=f[a])})}else d?F.addToSet(a,b,c):a[b]=c;return a},F.EventEmitter=new PseudoClass(Backbone.Events),function(){var a=/^(\S+)\s*(.*)$/,b=function(a,b){return a&&a[b]?_.isFunction(a[b])?a[b]():a[b]:null};F.View=Backbone.View.extend({initialize:function(a){if(this.options=a,void 0!==this.options.container&&void 0!==this.options.el)throw new Error("View: should provide either options.el or options.container, never both");this.template=this.options.template||this.template;if(this.render=this.render.bind(this),this.options.el){var b=this.$el[0].nodeName.toUpperCase(),c=this.tagName.toUpperCase();if("div"!==this.tagName&&b!==c)throw new Error("View: cannot create view, incorrect tag provided. Expected "+c+", but got "+b);this.$el.addClass(this.className)}this.container=this.options.container,this.component=this.options.component,this.options.events&&this.delegateEvents(this.options.events),this.options.model&&this.setModel(this.options.model),this.rendered=null},setModel:function(a){this.model&&this.model.off&&this.stopListening(this.model),this.model=a;var b=this.options.noRerender||this.options.component&&this.options.component.options.noRerender;this.model&&this.model.on&&!b&&this.listenTo(this.model,"change",this.render),this.rendered=null},age:function(){return null!==this.rendered?(new Date).getTime()-this.rendered:-1},remove:function(){this.$el.remove(),this.model&&this.model.off&&this.stopListening()},show:function(){return this.template&&this.renderOnce(),this.$el.show(),this},hide:function(){return this.$el.hide(),this},renderOnce:function(){return null===this.rendered&&this.render(),this},inDebugMode:function(){return F.options.debug||this.component&&this.component.options.debug},render:function(){if(this.inDebugMode()&&console.log("%s: Rendering view...",this.component&&this.component.toString()||"Orphaned view"),this.template){var a=this.model||this.component&&this.component.model;this.$el.html(this.template(a&&a.toJSON&&a.toJSON()||a||{}))}return this.container&&!$(this.el.parentNode).is(this.container)&&$(this.container).append(this.el),this.rendered=(new Date).getTime(),this.trigger("renderComplete"),this},delegateEvents:function(c){if(c||(c=b(this,"events"))){this.undelegateEvents();for(var d in c){var e=c[d],f=this.component;if(!_.isFunction(e))if(this.component){var g=c[d].split(".");if(g.length>1){e=this.component;for(var h=0;h<g.length;h++){var i=g[h];if(f=e,e=e[i],!e)break}}else e=this.component[c[d]]}else e=this[c[d]];if(!e)throw new Error('Method "'+c[d]+'" does not exist');var j=d.match(a),k=j[1],l=j[2];e=this.component?_.bind(e,f):_.bind(e,this),k+=".delegateEvents"+this.cid,""===l?this.$el.bind(k,e):this.$el.delegate(l,k,e)}return this}}})}(),function(){function a(a){return a.slice(0,1).toLowerCase()+a.slice(1)}F.Component=new PseudoClass({toString:"Component",extend:F.EventEmitter,options:{singly:!1,visible:!1,debug:!1,independent:!1},construct:function(a){this.mergeOptions(a),this.components={},this._bubbledEvts={},this.bind("_handleSubComponentShown"),this.bind("render")},init:function(){if(this.view){this.view.el?this.options.visible===!0?this.show({silent:!0}):this.view.$el.hide():console.warn("Component %s has a view without an element",this.toString,this,this.view,this.view.options);var a=this;this.listenTo(this.view,"renderComplete",function(){"function"==typeof this.handleRenderComplete&&this.handleRenderComplete(),this.teardownIfSetup(),this.setupIfNotSetup(),a.trigger("view:rendered",{component:a,view:a.view})})}},destruct:function(){this.view&&this.view.remove(),this.teardownIfSetup(),this.removeComponents(),this.stopListening(),delete this.components},render:function(){return this.view&&this.view.render(),this.isVisible()||this.view.$el.hide(),this},bind:function(a){"function"==typeof this[a]&&(this[a]=this[a].bind(this))},unbind:void 0,bubble:function(a,b){if(!this[a])return console.error("%s: cannot set event '%s' for bubbling from component '%s', component does not exist",this.toString(),b,a),this;this._bubbledEvts[a]||(this._bubbledEvts[a]={});var c=this._bubbledEvts[a][b]=function(){var a=Array.prototype.slice.call(arguments);a.unshift(b),this.trigger.apply(this,a)}.bind(this);return this[a].on(b,c),this},unbubble:function(a,b){return this._bubbledEvts[a]&&this._bubbledEvts[a][b]?(this[a].off(b,this._bubbledEvts[a][b]),this):(console.warn("%s: cannot discontinue bubbling of event '%s' for component '%s', event was not set for bubbling",this.toString(),b,a),this)},addComponent:function(b,c){return c=a(c?c:b.toString()),b.setName(c),this[c]=this.components[c]=b,b.parent=this,this.listenTo(b,"component:shown",this._handleSubComponentShown),b},removeComponent:function(a){var b=this.components[a];return void 0!==b&&(this.stopListening(b),delete this[a],delete this.components[a],"function"==typeof b.destruct&&b.destruct()),this},removeComponents:function(){for(var a in this.components)this.removeComponent(a);return this},_handleSubComponentShown:function(a){var b=this.components[a.name];void 0!==b&&(this.options.singly&&!b.options.independent&&(this.hideAllSubComponents([a.name]),this.currentSubComponent=b),this.trigger("subComponent:shown",{name:a.name,component:b}))},show:function(a){return a=a||{},this.inDebugMode()&&(this.isVisible()?console.log("%s: not showing self; already visible",this.toString()):console.log("%s: showing self",this.toString())),a.silent||this.trigger("component:shown",{name:this.toString(),component:this}),this.view&&this.view.show(),this.setupIfNotSetup(),this.options.visible=!0,this},hide:function(a){return a=a||{},this.isVisible()?(this.inDebugMode()&&console.log("%s: hiding self",this.toString()),this.view&&this.view.hide(),a.silent||this.trigger("component:hidden",{name:this.toString(),component:this}),this.teardownIfSetup(),this.options.hideChildren!==!1&&this.hideAllSubComponents(),this.options.visible=!1,this):!1},teardownIfSetup:function(){this.options.isSetup&&"function"==typeof this.teardown&&(this.teardown(),this.options.isSetup=!1)},setupIfNotSetup:function(){this.options.isSetup||"function"!=typeof this.setup||(this.setup(),this.options.isSetup=!0)},inDebugMode:function(){return this.options.debug||F.options.debug},isVisible:function(){return this.options.visible},showAllSubComponents:function(a){a=_.isArray(a)?a:!1;for(var b in this.components)a&&~a.indexOf(b)||this.components[b].show();return this},hideAllSubComponents:function(a){a=_.isArray(a)?a:!1;for(var b in this.components)a&&~a.indexOf(b)||this.components[b].hide();return this},setName:function(a){return this.toString=function(){return a},this},setPropsFromOptions:function(a,b){return _.each(b,function(b){this[b]=a[b]||this[b],delete a[b]}.bind(this)),this},mergeOptions:function(a){for(var b=[],c=this.constructor.prototype;c;)c.hasOwnProperty("options")&&b.unshift(c.options),c=c.superPrototype;b.unshift({}),a&&b.push(a),this.options=_.extend.apply(_,b)}})}(),F.ModelComponent=new PseudoClass({toString:"ModelComponent",extend:F.Component,construct:function(a){this.Model=this.Model||a.Model},Model:Backbone.Model,refresh:function(a){return this.trigger("model:loading",{model:this.model}),this.model.fetch({success:function(b,c){var d=!0;"function"==typeof this.handleLoadSuccess&&(d=this.handleLoadSuccess(this.model,c)===!1?!1:!0),d&&(this.model.trigger("loaded"),this.trigger("model:loaded",{model:this.model}),"function"==typeof a&&a.call(this,this.model))}.bind(this),error:function(a,b){console.warn("%s: Error loading model",this.toString()),this.trigger("model:loadFailed",{model:this.model,response:b}),"function"==typeof this.handleLoadError&&this.handleLoadError(this.model,b)}.bind(this)}),this},_setModel:function(a){return this.model=a,this.model&&this.model.off&&this.view&&this.view.setModel(a),this.model&&this.model.on&&this.listenTo(this.model,"change",this._triggerChange),this},_triggerChange:function(){this.trigger("model:changed",{model:this.model})},fetch:function(a,b){var c={};void 0!==a&&(c[this.Model.prototype.idAttribute]=a),this.trigger("model:loading",{model:this.model});var d=new this.Model(c);return d.fetch({success:function(a,c){this._setModel(a);var d=this._handleLoadComplete(c);d&&"function"==typeof b&&b.call(this,this.model)}.bind(this),error:function(a,b){console.warn("%s: Error loading model",this.toString()),this.trigger("model:loadFailed",{model:this.model,response:b}),"function"==typeof this.handleLoadError&&this.handleLoadError(this.model,b)}.bind(this)}),this},_handleLoadComplete:function(a){var b=!0;return"function"==typeof this.handleLoadSuccess&&(b=this.handleLoadSuccess(this.model,a||{local:!0})===!1?!1:!0),b&&this.trigger("model:loaded",{model:this.model}),b},load:function(a){return this._setModel(a instanceof Backbone.Model?a:new this.Model(a)),this._handleLoadComplete(),this},save:function(a,b,c){return this.model?(this.inDebugMode()&&console.log("%s: Saving...",this.toString()),this.trigger("model:saving",{model:this.model}),this.model.save(a||{},_.extend({success:function(a,c){this.inDebugMode()&&console.log("%s: Save successful",this.toString()),"function"==typeof b&&b.call(this,null,this.model,c),"function"==typeof this.handleSaveSuccess&&this.handleSaveSuccess(this.model,c),this.trigger("model:saved",{model:this.model,response:c})}.bind(this),error:function(a,c){console.warn("%s: Error saving model",this.toString()),"function"==typeof b&&b.call(this,new Error("Error saving model"),this.model,c),"function"==typeof this.handleSaveError&&this.handleSaveError(this.model,c),this.trigger("model:saveFailed",{model:this.model,response:c})}.bind(this)},c))):console.warn("%s: Cannot save, model is not truthy",this.toString()),this},show:function(a){return a=a||{},a.id?(this.inDebugMode()&&console.log("%s: fetching item with ID %s",this.toString(),a.id),this.fetch(a.id,function(){this.inDebugMode()&&console.log("%s: fetch complete!",this.toString()),this.show({silent:a.silent})})):a.model?(this.inDebugMode()&&console.log("%s: showing with new model",this.toString(),a.model),this.load(a.model),this.show({silent:a.silent})):this._super.apply(this,arguments),this}}),F.CollectionComponent=new PseudoClass({toString:"CollectionComponent",extend:F.Component,options:{defaultParams:{}},construct:function(a){this.bind("addModel"),this.bind("removeModel"),this.bind("render"),this._useCollection(a.collection||new this.Collection),this.collectionLoaded=!!a.collection},destruct:function(){this._releaseCollection()},Collection:Backbone.Collection,_useCollection:function(a){this.collection=a,this.listenTo(this.collection,"add",this.addModel),this.listenTo(this.collection,"remove",this.removeModel),this.listenTo(this.collection,"loaded",this.render)},_releaseCollection:function(){this.stopListening(this.collection),this.collection=null},refresh:function(a){return this.fetch(this.params,a),this},addModel:function(){},removeModel:function(){},clearParams:function(){return this.params={},this},fetch:function(a,b){return this.params=a?_.extend({},this.options.defaultParams,a):_.extend({},this.options.defaultParams),this.trigger("collection:loading",this.collection),this.collection.fetch({data:this.params,success:function(){this.collection&&(this.collection.trigger("loaded"),this.trigger("collection:loaded",this.collection),this.collectionLoaded=!0,"function"==typeof b&&b.call(this,this.collection))}.bind(this)}),this},load:function(a){return this._releaseCollection(),this._useCollection(a instanceof Backbone.Collection?a:new this.Collection(a)),this},show:function(a){return a=a||{},a.params?this.fetch(a.params,function(){this.show({silent:a.silent})}):this.collectionLoaded?this._super.apply(this,arguments):this.refresh(function(){this.show({silent:a.silent})}),this}}),function(){var a=F.View.extend({tagName:"form",events:{submit:"handleSubmit"}});F.FormComponent=new PseudoClass({toString:"FormComponent",extend:F.ModelComponent,construct:function(a){this.view=new this.View(_.extend({component:this,template:this.Template},a)),this.model=new this.Model,this.bind("handleSubmit")},View:a,Template:null,clear:function(){this._setModel(new this.Model);return"function"==typeof this.handleLoadSuccess&&this.handleLoadSuccess(this.model),this.render(),this},doBlur:function(){var a=this.view.$('[type="submit"], button').filter(":visible").last().focus();setTimeout(function(){a.blur()},10)},handleSubmit:function(a){this.doBlur(),a&&a.preventDefault&&a.preventDefault(),this.saveForm()},extractValuesFromForm:function(){var a=this.view.$el;"FORM"!==this.view.el.tagName&&(a=this.view.$("form"));var b=a.filter(':not([data-serialize="false"])').serializeArray(),c={};return _.each(b,function(a){F.set(c,a.name,a.value,!0)}),c},setValuesFromForm:function(){this.model.set(this.extractValuesFromForm())},saveForm:function(a){this.save(this.extractValuesFromForm(),a)}})}(),function(){var a=F.View.extend({tagName:"ul",initialize:function(a){a=a||{},F.View.prototype.initialize.apply(this,arguments),this.ItemView=a.ItemView||this.ItemView,this.ItemTemplate=a.ItemTemplate||this.ItemTemplate,this.subViews=[],this.addSubView=this.addSubView.bind(this)},addSubView:function(a){if(this.rendered){var b=new this.ItemView({model:a,template:this.ItemTemplate,component:this.component});b.render(),this.options.ListContainer?this.$(this.options.ListContainer).append(b.el):this.$el.append(b.el),b.$el.data("viewIndex",this.subViews.length),this.subViews.push(b)}},remove:function(){this.removeSubViews(),F.View.prototype.remove.call(this,arguments)},removeSubView:function(a){if(this.rendered){var b=null,c=-1;"Number"!=typeof c?_.some(this.subViews,function(d,e){d&&d.model===a&&(b=d,c=e)}.bind(this)):b=this.subViews[c],b&&(b.remove(),this.subViews[c]=void 0)}},removeSubViews:function(){this.subViews.length&&(_.each(this.subViews,function(a){a&&a.remove()}),this.subViews=[])},show:function(){this.renderOnce(),this.$el.show()},render:function(){if(this.inDebugMode()&&console.log("%s: rendering list view...",this.component&&this.component.toString()||"List view"),this.container&&!$(this.el.parentNode).is(this.container)&&$(this.container).append(this.el),null===this.rendered&&(this.template&&this.$el.html(this.template({})),this.rendered=(new Date).getTime()),this.removeSubViews(),this.component.collection.each(this.addSubView),this.component.collection.isEmpty()){var a,b=this.ItemView;if(!this.component.params||_.isEqual(this.component.params,this.component.options.defaultParams)&&this.component.ListEmptyTemplate?(a=this.component.ListEmptyTemplate,this.component.ListEmptyView&&(b=this.component.ListEmptyView)):this.component.NoResultsTemplate&&(a=this.component.NoResultsTemplate,this.component.NoResultsView&&(b=this.component.NoResultsView)),a){var c=new b({template:a,component:this.component,model:this.component.params}).render();this.options.ListContainer?this.$(this.options.ListContainer).append(c.el):this.$el.append(c.el),this.subViews.push(c)}}return this.rendered=(new Date).getTime(),this.trigger("renderComplete"),this}}),b=F.View.extend({tagName:"li",className:"listItem"});F.ListComponent=new PseudoClass({toString:"ListComponent",extend:F.CollectionComponent,construct:function(a){this.view=new this.ListView(_.extend({component:this,template:this.ListTemplate,ItemView:this.ItemView,ItemTemplate:this.ItemTemplate,ListContainer:this.ListContainer,events:_.extend({},{"click li":"handleSelect"},this.ListView.prototype.events)},a)),this.selectedItem=null},Collection:Backbone.Collection,NoResultsTemplate:null,NoResultsView:null,ListEmptyView:null,ListEmptyTemplate:null,ListTemplate:null,ListView:a,ItemTemplate:null,ItemView:b,addModel:function(a){this.view.addSubView(a)},removeModel:function(a){this.view.removeSubView(a)},getModelFromLi:function(a){var b=$(a).data("viewIndex");return void 0!==b&&this.view.subViews[b]&&this.view.subViews[b].model||null},getViewFromLi:function(a){return this.view.subViews[$(a).data("viewIndex")]},handleSelect:function(a){var b=this.getModelFromLi(a.currentTarget);b&&(this.selectedItem=b.id,this.trigger("list:itemSelected",{listItem:$(a.currentTarget),model:b}))}})}();
//# sourceMappingURL=F.min.js.map